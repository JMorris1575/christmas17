
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>5. The Trivia App &#8212; Christmas 2017 1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. Notes" href="notes.html" />
    <link rel="prev" title="4. New Applications" href="new_apps.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-trivia-app">
<span id="trivia-app-document"></span><h1>5. The Trivia App<a class="headerlink" href="#the-trivia-app" title="Permalink to this headline">¶</a></h1>
<p>I have decided to document the creation of the trivia app here instead of in the <code class="docutils literal"><span class="pre">new_apps.rst</span></code> document. It should
make for shorter, more manageable documents.</p>
<div class="section" id="initial-thoughts">
<h2>5.1. Initial Thoughts<a class="headerlink" href="#initial-thoughts" title="Permalink to this headline">¶</a></h2>
<p>To build the trivia app I’m thinking I will have to:</p>
<ol class="arabic simple">
<li>Use <code class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">startapp</span> <span class="pre">trivia</span></code> to create the app</li>
<li>Include a line saying <code class="docutils literal"><span class="pre">'trivia.apps.TriviaConfig'</span></code> in the <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code> setting in <code class="docutils literal"><span class="pre">base.py</span></code></li>
<li>Settle on a URL scheme for navigating the pages of the app</li>
<li>Implement the URL scheme in <code class="docutils literal"><span class="pre">trivia.urls.py</span></code></li>
<li>Update <code class="docutils literal"><span class="pre">config.urls.py</span></code> to include the trivia urls</li>
<li>Add a menu item in the header to direct the users to the trivia pages</li>
<li>Decide on the models needed to implement the app</li>
<li>Create the models needed in <code class="docutils literal"><span class="pre">trivia.models.py</span></code></li>
<li>Implement the views needed in <code class="docutils literal"><span class="pre">trivia.views.py</span></code></li>
<li>Implement the templates needed in <code class="docutils literal"><span class="pre">trivia.templates</span></code></li>
<li>Make the templates look good</li>
</ol>
<p>The first two steps are easy. I have just completed them. The others I have rearranged so that I can take a TDD approach
to building the new app.</p>
</div>
<div class="section" id="the-trivia-url-patterns">
<h2>5.2. The Trivia URL Patterns<a class="headerlink" href="#the-trivia-url-patterns" title="Permalink to this headline">¶</a></h2>
<p>Looking over the <code class="docutils literal"><span class="pre">new_apps.rst</span></code> file I see my first idea for the url patterns:</p>
<table border="1" class="colwidths-auto docutils" id="id2">
<caption><span class="caption-text"><strong>URLs for the trivia app</strong></span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">URL</th>
<th class="head">Page(s) Addressed</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>/trivia/scoreboard/</td>
<td>the scoreboard page (scoreboard.html)</td>
</tr>
<tr class="row-odd"><td>/trivia/question/n/</td>
<td>question n’s page (trivia_question.html)</td>
</tr>
<tr class="row-even"><td>/trivia/result/n/</td>
<td>question n’s results page (trivia_result.html)</td>
</tr>
</tbody>
</table>
<p>Something tells me I am going to need more but this will do for a start. Here are the url patterns to be tried in
<code class="docutils literal"><span class="pre">trivia.urls.py</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span>
        <span class="n">RedirectView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="s1">&#39;/trivia/scoreboard/&#39;</span><span class="p">)),</span>
        <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^scoreboard/$&#39;</span><span class="p">,</span>
            <span class="n">Scoreboard</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;scoreboard&#39;</span><span class="p">),</span>
        <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^question/(?P&lt;questionNumber&gt;[0-9]+)/$&#39;</span><span class="p">,</span>
            <span class="n">DisplayQuestion</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;display_question&#39;</span><span class="p">),</span>
        <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^result/(?P&lt;questionNumber&gt;[0-9]+)/$&#39;</span><span class="p">,</span>
            <span class="n">DisplayResult</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;display_result&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>I will try to implement them one at a time, stub in the views, and create place-holder html files.</p>
<div class="section" id="building-and-testing-the-url-patterns">
<h3>5.2.1. Building and Testing the URL Patterns<a class="headerlink" href="#building-and-testing-the-url-patterns" title="Permalink to this headline">¶</a></h3>
<div class="section" id="the-trivia-and-trivia-scoreboard-patterns">
<h4>5.2.1.1. The /trivia/ and /trivia/scoreboard/ Patterns<a class="headerlink" href="#the-trivia-and-trivia-scoreboard-patterns" title="Permalink to this headline">¶</a></h4>
<p>For now I will test the patterns simply by entering them in the address line. Here is a test to see if entering
<code class="docutils literal"><span class="pre">/trivia/</span></code> redirects to <code class="docutils literal"><span class="pre">/trivia/scoreboard/</span></code></p>
<table border="1" class="colwidths-auto docutils" id="id3">
<caption><span class="caption-text"><strong>Does entering /trivia/ in the address line redirect to /trivia/scoreboard/?</strong></span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>include the trivia urls in <code class="docutils literal"><span class="pre">config/urls.py</span></code></td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>proceed to test <code class="docutils literal"><span class="pre">/trivia/scoreboard/</span></code></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="colwidths-auto docutils" id="id4">
<caption><span class="caption-text"><strong>Does entering ``/trivia/scoreboard/`` in the address line display a fake scoreboard page?</strong></span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>create a <code class="docutils literal"><span class="pre">get</span></code> method in the <code class="docutils literal"><span class="pre">Scoreboard</span></code> class</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>TemplateDoesNotExist error; create the <code class="docutils literal"><span class="pre">scoreboard.html</span></code> file along with <code class="docutils literal"><span class="pre">base_trivia.html</span></code></td>
</tr>
<tr class="row-even"><td>Yes</td>
<td>once I got the details right - like putting the html files in <code class="docutils literal"><span class="pre">templates</span></code> rather than <code class="docutils literal"><span class="pre">static</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="the-trivia-question-n-pattern">
<h4>5.2.1.2. The /trivia/question/n/ Pattern<a class="headerlink" href="#the-trivia-question-n-pattern" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto docutils" id="id5">
<caption><span class="caption-text"><strong>Does entering /trivia/question/n/ result in the diplay of a fake question page for that question?</strong></span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>create the url pattern</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>(in terminal: Method Not Allowed (GET)); add get method to DisplayQuestion view</td>
</tr>
<tr class="row-even"><td>No</td>
<td>unexpected keyword argument ‘questionNumber’; add <code class="docutils literal"><span class="pre">question_number=None</span></code> to get’s arguments; change in urls.py</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>TemplateDoesNotExist; create the <code class="docutils literal"><span class="pre">trivia_question.html</span></code> file</td>
</tr>
<tr class="row-even"><td>No</td>
<td>it displays without referring to which question it is pretending to display; add <code class="docutils literal"><span class="pre">q_number</span></code> to render and html</td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>go on to test /trivia/results/n/</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="the-trivia-result-n-pattern">
<h4>5.2.1.3. The /trivia/result/n/ Pattern<a class="headerlink" href="#the-trivia-result-n-pattern" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto docutils" id="id6">
<caption><span class="caption-text"><strong>Does entering /trivia/result/n/ result in the diplay of a fake result page for that question?</strong></span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>Page not found; create the url pattern</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>GET method not allowed; add get() method to DisplayResult view</td>
</tr>
<tr class="row-even"><td>No</td>
<td>TemplateDoesNotExist; create the <code class="docutils literal"><span class="pre">trivia_result.html</span></code> template</td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>now test for authentication</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="preventing-access-by-unauthenticated-users">
<h3>5.2.2. Preventing access by Unauthenticated Users<a class="headerlink" href="#preventing-access-by-unauthenticated-users" title="Permalink to this headline">¶</a></h3>
<table border="1" class="colwidths-auto docutils" id="id7">
<caption><span class="caption-text"><strong>Does the system prevent an unauthenticated user from entering any page in the trivia app?</strong></span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>I entered /trivia/scoreboard/ without being authenticated; add <code class="docutils literal"><span class="pre">login_required</span></code> to urls</td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>the website is safe once again!</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="displaying-the-header-on-each-trivia-page">
<h3>5.2.3. Displaying the Header on Each Trivia Page<a class="headerlink" href="#displaying-the-header-on-each-trivia-page" title="Permalink to this headline">¶</a></h3>
<p id="index-0">Because I had made a mistake earlier in placing my .html files in a newly created trivia/static/ directory instead of
a trivia/templates/ directory where they belong, I had done a refactor in PyCharm without thinking it through very
carefully. Because I allowed it without looking it went and changed several references throughout the program that were
supposed to say ‘static’ to ‘templates’. I think I got them all, two in base.html, two in dev.py and two in prod.py.
If things seem to go haywire later, look around for references to ‘templates’ that should be to ‘static’.</p>
<p>This also broke the display of the header and footer on all of the pages of the website (since it couldn’t find the
static files). I got the header back once fixing the references but I might as well add the display of memories to the
trivia pages also.</p>
<table border="1" class="colwidths-auto docutils" id="id8">
<caption><span class="caption-text"><strong>Do the Memories appear on each of the trivia pages?</strong></span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>Add the context {‘display_memory’: utils.get_memory()} and the import of utils to each trivia view</td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>but entering something like /trivia/question/ results in a PageNotFound error.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="redirecting-badly-formed-trivia-urls-to-the-scoreboard-page">
<h3>5.2.4. Redirecting Badly Formed trivia urls to the Scoreboard Page<a class="headerlink" href="#redirecting-badly-formed-trivia-urls-to-the-scoreboard-page" title="Permalink to this headline">¶</a></h3>
<table border="1" class="colwidths-auto docutils" id="id9">
<caption><span class="caption-text"><strong>Does entering /trivia/question/ or /trivia/result/ without the /n/ redirect to the scoreboard page?</strong></span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>Page not found error; add url patterns to redirect to scoreboard</td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>but it didn’t work the way I thought. See below.</td>
</tr>
</tbody>
</table>
<p>In order to redirect to the scoreboard I had to use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">RedirectView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">pattern_name</span><span class="o">=</span><span class="s1">&#39;scoreboard&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>I found this in <em>Django Unleashed</em> page 398.</p>
</div>
</div>
<div class="section" id="adding-a-trivia-menu-item-to-the-header">
<h2>5.3. Adding a Trivia Menu Item to the Header<a class="headerlink" href="#adding-a-trivia-menu-item-to-the-header" title="Permalink to this headline">¶</a></h2>
<p>This should be easy, just add a list item and direct it to the scoreboard.</p>
<table border="1" class="colwidths-auto docutils" id="id10">
<caption><span class="caption-text"><strong>Does the header include a working Trivia link after “Question of the Day”?</strong></span><a class="headerlink" href="#id10" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>add a &lt;li&gt; item to the header page.</td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>time for bed</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="moving-to-kalamazoo-again">
<h2>5.4. Moving to Kalamazoo Again<a class="headerlink" href="#moving-to-kalamazoo-again" title="Permalink to this headline">¶</a></h2>
<p>Through PyCharm I did a Git Pull, which required me to do a revert since I did a make html after the last commit and it
changed some files in _build I didn’t really care about.</p>
<p>I tried to do a migrate and it informed me I needed to makemigrations first. I did that, then the migrate. Both seemed
to work fine.</p>
<p>I did a <code class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">loaddata</span> <span class="pre">all.json</span></code> and it seemed to work perfectly, including the UserProfile data in the
database. It kept last year’s questions in the database so I deleted them through the <code class="docutils literal"><span class="pre">/admin</span></code> app.</p>
<p>Now I should be ready to proceed.</p>
</div>
<div class="section" id="working-on-the-models">
<h2>5.5. Working on the Models<a class="headerlink" href="#working-on-the-models" title="Permalink to this headline">¶</a></h2>
<p>Now that the URLs are working it is time to start working on the models. I have already designed, or at least partially
designed the models <a class="reference internal" href="new_apps.html#trivia-model-design"><span class="std std-ref">here</span></a>. That seems like as good a starting point as any, except that the
fields of the “TriviaUserProgress” model should probably just be added to the UserProfile Model.</p>
<div class="section" id="creating-the-trivia-models">
<h3>5.5.1. Creating the Trivia Models<a class="headerlink" href="#creating-the-trivia-models" title="Permalink to this headline">¶</a></h3>
<p>Here are the trivia models as I created them:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="k">import</span> <span class="n">settings</span>

<span class="c1"># Create your models here.</span>

<span class="k">class</span> <span class="nc">TriviaQuestion</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">attempted</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">TriviaChoices</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">TriviaQuestion</span><span class="p">)</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;question&#39;</span><span class="p">,</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">TriviaUserResponses</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">)</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">TriviaQuestion</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">TriviaChoices</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;&#39;s response to question &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">question</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">TriviaConversation</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">)</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry</span>
</pre></div>
</div>
<p>I also modified the UserProfile model as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UserProfile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">)</span>
    <span class="n">gift_selected</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Gift</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">added_memories</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">trivia_questions_attempted</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">trivia_answers_correct</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Profile for &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get_full_name</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">first_name</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Brian&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">last_name</span>
        <span class="k">return</span> <span class="n">name</span>
</pre></div>
</div>
<p>Finally, the trivia.admin.py program had to have some additions to it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="k">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="k">import</span> <span class="n">TriviaQuestion</span><span class="p">,</span> <span class="n">TriviaChoices</span><span class="p">,</span> <span class="n">TriviaUserResponses</span><span class="p">,</span> <span class="n">TriviaConversation</span>

<span class="c1"># Register your models here.</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">TriviaQuestion</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">TriviaChoices</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">TriviaUserResponses</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">TriviaConversation</span><span class="p">)</span>
</pre></div>
</div>
<p>I will do a commit here before trying to use these models.</p>
<div class="section" id="migrations-with-the-new-trivia-models">
<h4>5.5.1.1. Migrations with the New Trivia Models<a class="headerlink" href="#migrations-with-the-new-trivia-models" title="Permalink to this headline">¶</a></h4>
<p>First I will need to do a makemigrations and a migrate… I got an error:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ERRORS</span><span class="p">:</span>
<span class="n">trivia</span><span class="o">.</span><span class="n">TriviaUserResponses</span><span class="p">:</span> <span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">E015</span><span class="p">)</span> <span class="s1">&#39;ordering&#39;</span> <span class="n">refers</span> <span class="n">to</span> <span class="n">the</span> <span class="n">non</span><span class="o">-</span><span class="n">existent</span> <span class="n">field</span> <span class="s1">&#39;question.number&#39;</span><span class="o">.</span>
</pre></div>
</div>
<p>so I guess I can’t do it that way, but I suppose with TriviaQuestion already being ordered by number I can just use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>in the TriviaUserResponses model.</p>
<p>Tried to do a <strong>makemigrations</strong> again and this time got a non-nullable field: <code class="docutils literal"><span class="pre">trivia_answers_correct</span></code> in my
UserProfile updates. I will set the default of both of the new fields to zero (0).</p>
<p>This time <strong>makemigrations</strong> worked and I added both of the new migration files to Git. Running <strong>migrate</strong> worked
without any problems.</p>
</div>
<div class="section" id="entering-data-into-the-trivia-models">
<h4>5.5.1.2. Entering Data into the Trivia Models<a class="headerlink" href="#entering-data-into-the-trivia-models" title="Permalink to this headline">¶</a></h4>
<p>I haven’t actually decided on a set of trivia questions yet so, except for the first question, for development I will
add a bunch of fake questions and choices to the models through the admin app.</p>
<p>When I entered the first question it complained that I hadn’t entered anything for <code class="docutils literal"><span class="pre">attempted</span></code> or <code class="docutils literal"><span class="pre">correct</span></code>. I will
supply defaults, do another <strong>makemigrations</strong> and another <strong>migrate</strong>. This was done with no problems.</p>
<p>While entering the data into the TriviaChoice model I decided to modify the ordering of that model. That line now
contains <code class="docutils literal"><span class="pre">ordering</span> <span class="pre">=</span> <span class="pre">['question',</span> <span class="pre">'number']</span></code></p>
<p>Entering the data this way is quite painful. Either the <code class="docutils literal"><span class="pre">/admin</span></code> app allows two related models to have data entered at
the same time or I can work on a page to create questions and their possible choices.</p>
</div>
</div>
</div>
<div class="section" id="building-the-trivia-app">
<h2>5.6. Building the Trivia App<a class="headerlink" href="#building-the-trivia-app" title="Permalink to this headline">¶</a></h2>
<p>With the models in place I can start building the app, step by step, using my modified version of Test Driven
Development (TDD). Here is an initial plan – which will probably not be adhered to very closely:</p>
<ol class="arabic simple">
<li>Have the game rules appear on the scoreboard page.</li>
<li>Have a ‘First Question’/’Next Question’ button appear on the scoreboard page.</li>
<li>Clicking the ‘First Question’ button sends them to the first question page which identifies itself as such.</li>
<li>The question page displays the question.</li>
<li>The question page displays the possible answers with radio buttons next to each.</li>
<li>The question page displays a working ‘Submit’ button</li>
<li>Clicking the submit button sends the user to the results page.</li>
<li>Clicking the submit button records the users response to this question</li>
<li>Clicking the submit button updates the user’s statistics in UserProfile</li>
<li>The results page informs them of whether their answer was correct</li>
<li>The results page displays the user’s statistics: questions answered, number correct, percentage correct</li>
<li>The results page displays a ‘Next’ button which sends the user to the next question</li>
<li>Entering the url for later questions still sends the user to the next question in line for them</li>
<li>The scoreboard page displays participating user scores</li>
<li>The scoreboar page displays participating user scores in descending sequence</li>
<li>The scoreboard page displays participating user scores in groups depending on the number of questions completed.</li>
</ol>
<div class="section" id="game-rules">
<h3>5.6.1. Game Rules<a class="headerlink" href="#game-rules" title="Permalink to this headline">¶</a></h3>
<table border="1" class="colwidths-auto docutils" id="id11">
<caption><span class="caption-text"><strong>Do the game rules appear on the scoreboard page?</strong></span><a class="headerlink" href="#id11" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>Write them into scoreboard.html</td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>I also centered it</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="the-question-page">
<h3>5.6.2. The Question Page<a class="headerlink" href="#the-question-page" title="Permalink to this headline">¶</a></h3>
<p>Here are the steps to producing a functioning Question Page</p>
<div class="section" id="question-button">
<h4>5.6.2.1. Question Button<a class="headerlink" href="#question-button" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto docutils" id="id12">
<caption><span class="caption-text"><strong>Does a question button (First Question or Next Question) appear on the scoreboard page?</strong></span><a class="headerlink" href="#id12" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>write it into scoreboard.html directing it to a <code class="docutils literal"><span class="pre">next_trivia_question</span></code> url (<a class="reference internal" href="#id1"><span class="std std-ref">See below.</span></a>)</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>modify UserProfile model to include a get_next_trivia function and use it in template</td>
</tr>
<tr class="row-even"><td>No</td>
<td>It is not a button; enclose a &lt;button&gt; element within the &lt;a&gt; tag.</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>‘Next Question’ not ‘First Question’ - change ‘if’ statement to user.userprofile.trivia_questions_attempted==0</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="colwidths-auto docutils" id="id13">
<caption><span class="caption-text"><strong>Is the question button centered horizontally on the screen?</strong></span><a class="headerlink" href="#id13" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>create a <code class="docutils literal"><span class="pre">center-button</span></code> css class and use it in <code class="docutils literal"><span class="pre">scoreboard.html</span></code> (<a class="reference internal" href="#ctr-btn-class"><span class="std std-ref">See below</span></a>.)</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>put the button in some sort of outer wrapper: &lt;p&gt; or &lt;div&gt; and center that</td>
</tr>
<tr class="row-even"><td>Yes</td>
<td>I chose the &lt;p&gt; element; my css needs a LOT of work!</td>
</tr>
</tbody>
</table>
<p id="id1">Here is the initial html for the question button:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">trivia_questions_attempted</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">a</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;button&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;{</span><span class="si">% u</span><span class="s2">rl &#39;next_page&#39; %}&quot;</span><span class="o">&gt;</span><span class="n">First</span> <span class="n">Question</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">a</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;button&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;{</span><span class="si">% u</span><span class="s2">rl &#39;next_page&#39; %}&quot;</span><span class="o">&gt;</span><span class="n">Next</span> <span class="n">Question</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p id="ctr-btn-class">Here was my first attempt at creating a class to center buttons:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">center</span><span class="o">-</span><span class="n">button</span> <span class="p">{</span>
    <span class="n">width</span><span class="p">:</span> <span class="mi">150</span><span class="n">px</span><span class="p">;</span>
    <span class="n">margin</span><span class="o">-</span><span class="n">left</span><span class="p">:</span> <span class="n">auto</span><span class="p">;</span>
    <span class="n">margin</span><span class="o">-</span><span class="n">right</span><span class="p">:</span> <span class="n">auto</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="displaying-the-trivia-question-page">
<h4>5.6.2.2. Displaying the Trivia Question Page<a class="headerlink" href="#displaying-the-trivia-question-page" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto docutils" id="id14">
<caption><span class="caption-text"><strong>Does clicking on the ‘First Question’ get the user to the first question page?</strong></span><a class="headerlink" href="#id14" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>it reloads scoreboard; edit the <code class="docutils literal"><span class="pre">get_next_trivia</span></code> function in user.models.py (<a class="reference internal" href="#gt-nxt-trv"><span class="std std-ref">See below</span></a>.)</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>still reloads scoreboard; edit <code class="docutils literal"><span class="pre">scoreboard.html</span></code> to say <code class="docutils literal"><span class="pre">href=&quot;user.userprofile.get_next_trivia&quot;</span></code></td>
</tr>
<tr class="row-even"><td>No</td>
<td>Page not found looking for <code class="docutils literal"><span class="pre">trivia/scoreboard/1</span></code>; create the appropriate {% url … %} tag</td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>it took a while to find the <a class="reference internal" href="#new-next-ques-btn"><span class="std std-ref">appropriate</span></a> tag but it works now</td>
</tr>
</tbody>
</table>
<p id="gt-nxt-trv">Originally, I had self.user.trivia_questions_attempted, but that was silly! Here is the final form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_next_trivia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">next_ques</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trivia_questions_attempted</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;next_ques = &#39;</span><span class="p">,</span> <span class="n">next_ques</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">next_ques</span>
</pre></div>
</div>
<p id="new-next-ques-btn">After a lot of trial and error, this is what I found to work:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">userprofile</span><span class="o">.</span><span class="n">trivia_questions_attempted</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">p</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;center-button&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;{</span><span class="si">% u</span><span class="s2">rl &#39;display_question&#39; user.userprofile.get_next_trivia %}&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">button</span><span class="o">&gt;</span><span class="n">First</span> <span class="n">Question</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">p</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;center-button&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;{</span><span class="si">% u</span><span class="s2">rl &#39;display_question&#39; user.userprofile.get_next_trivia %}&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">button</span><span class="o">&gt;</span><span class="n">Next</span> <span class="n">Question</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Currently, however, it only displays the stubbed in <code class="docutils literal"><span class="pre">trivia_question.html</span></code> page.</p>
</div>
<div class="section" id="displaying-questions-on-the-question-page">
<h4>5.6.2.3. Displaying Questions on the Question Page<a class="headerlink" href="#displaying-questions-on-the-question-page" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto docutils" id="id15">
<caption><span class="caption-text"><strong>Does the question page display the corresponding question?</strong></span><a class="headerlink" href="#id15" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>only stub; update <a class="reference internal" href="#disp-ques-view"><span class="std std-ref">DisplayQuestion</span></a> view and <a class="reference internal" href="#new-trv-ques-html"><span class="std std-ref">trivia_question.html</span></a></td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>worked (almost) the first time</td>
</tr>
</tbody>
</table>
<p id="disp-ques-view">Here is the first attempt at updating DisplayQuestion:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DisplayResult</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;trivia/trivia_result.html&#39;</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">question_number</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">question</span> <span class="o">=</span> <span class="n">TriviaQuestion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">question_number</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_name</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;display_memory&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_memory</span><span class="p">(),</span>
                                                    <span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="n">question</span><span class="p">})</span>
</pre></div>
</div>
<p>I also had to import TriviaQuestion of course.</p>
<p id="new-trv-ques-html">Here is the somewhat improved version of <code class="docutils literal"><span class="pre">trivia_question.html</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">content</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">h2</span><span class="o">&gt;</span><span class="n">Question</span> <span class="n">Number</span><span class="p">:</span> <span class="p">{{</span> <span class="n">question</span><span class="o">.</span><span class="n">number</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">h2</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
        <span class="p">{{</span> <span class="n">question</span> <span class="p">}}</span>
    <span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="displaying-possible-responses-on-the-question-page">
<h4>5.6.2.4. Displaying Possible Responses on the Question Page<a class="headerlink" href="#displaying-possible-responses-on-the-question-page" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto docutils" id="id16">
<caption><span class="caption-text"><strong>Do the possible responses to a question display with the corresponding question?</strong></span><a class="headerlink" href="#id16" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>adjust DisplayView to send the possible choices in the context and loop through them in <code class="docutils literal"><span class="pre">trivia_question.html</span></code></td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>now make them into radio buttons</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="displaying-possible-responses-as-radio-buttons">
<h4>5.6.2.5. Displaying Possible Responses as Radio Buttons<a class="headerlink" href="#displaying-possible-responses-as-radio-buttons" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto docutils" id="id17">
<caption><span class="caption-text"><strong>Do the possible responses display as radio buttons?</strong></span><a class="headerlink" href="#id17" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>Change them to &lt;input type=”radio”&gt;</td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>after some <a class="reference internal" href="#expt"><span class="std std-ref">experimentation</span></a> and adding a <a class="reference internal" href="#choice-index"><span class="std std-ref">method</span></a> to the TriviaChoices model</td>
</tr>
</tbody>
</table>
<p id="expt">Here is the html currently displaying the possible responses to the trivia questions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">choices</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;radio&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;choice&quot;</span> <span class="n">value</span><span class="o">=</span><span class="p">{{</span> <span class="n">choice</span><span class="o">.</span><span class="n">number</span> <span class="p">}}</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">choice</span><span class="o">.</span><span class="n">index</span> <span class="p">}}{{</span> <span class="n">choice</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="nb">input</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p id="choice-index">Here is the new index method added to the TriviaChoices model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">64</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;) &#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-a-trivia-question-form-with-a-working-submit-button">
<h3>5.6.3. Creating a Trivia Question Form with a working Submit Button<a class="headerlink" href="#creating-a-trivia-question-form-with-a-working-submit-button" title="Permalink to this headline">¶</a></h3>
<table border="1" class="colwidths-auto docutils" id="id18">
<caption><span class="caption-text"><strong>Does a Submit Button appear under the Question and its possible responses?</strong></span><a class="headerlink" href="#id18" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>Create a form with all the necessary id and value attributes in the input tags</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>since I set value=’response’ the button says ‘response’; change value to ‘Submit’</td>
</tr>
<tr class="row-even"><td>Yes</td>
<td>now get it to work</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="colwidths-auto docutils" id="id19">
<caption><span class="caption-text"><strong>Does clicking the Submit Button send the user to the result page?</strong></span><a class="headerlink" href="#id19" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>got a ‘Forbidden’ error because I forgot the {{ csrf.token }} in the form; insert the token</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>got the same error; change code to {% csrf.token %}</td>
</tr>
<tr class="row-even"><td>No</td>
<td>got a SyntaxError; change code to {% csrf_token %}</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>got a blank page; set form action to {% url ‘display_result’ %}</td>
</tr>
<tr class="row-even"><td>No</td>
<td>got a NoReverseMatch because arguments not found; add in the question number</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>blank page; add a post method to the <a class="reference internal" href="#disp-result-view"><span class="std std-ref">DisplayResult view</span></a></td>
</tr>
<tr class="row-even"><td>Yes</td>
<td>but only the stub result page</td>
</tr>
</tbody>
</table>
<p id="disp-result-view">Here is the initial form of the <code class="docutils literal"><span class="pre">post</span></code> function I added:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">question_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">choice</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">TriviaQuestion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">question_number</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_name</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;display_memory&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_memory</span><span class="p">(),</span>
                                                <span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="n">question</span><span class="p">,</span>
                                                <span class="s1">&#39;choice&#39;</span><span class="p">:</span> <span class="n">choice</span><span class="p">})</span>
</pre></div>
</div>
<p id="index-1">The <code class="docutils literal"><span class="pre">post</span></code> function above was not working. When I modified the result page stub to report on the user’s choice it
always reported that they had chosen None. As written above the function presumes that the choice information is coming
in through the url but it is actually in the <code class="docutils literal"><span class="pre">request.POST</span></code> data. Here is a way to access it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">question_number</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;choice&#39;</span><span class="p">]</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">TriviaQuestion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">question_number</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_name</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;display_memory&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_memory</span><span class="p">(),</span>
                                                <span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="n">question</span><span class="p">,</span>
                                                <span class="s1">&#39;choice&#39;</span><span class="p">:</span> <span class="n">choice</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="working-on-the-results-page">
<h3>5.6.4. Working on the Results Page<a class="headerlink" href="#working-on-the-results-page" title="Permalink to this headline">¶</a></h3>
<p>This will be a several step process:</p>
<ol class="arabic simple">
<li>The results page informs them of whether their answer was correct</li>
<li>The results page displays the user’s statistics: questions answered, number correct, percentage correct</li>
<li>The results page displays a ‘Next’ button which sends the user to the next question</li>
</ol>
<div class="section" id="changing-the-name-of-triviauserresponses">
<h4>5.6.4.1. Changing the Name of TriviaUserResponses<a class="headerlink" href="#changing-the-name-of-triviauserresponses" title="Permalink to this headline">¶</a></h4>
<p>In anticipation of what I will have to do in the next section, I noticed I had used the plural form when each entry is
just a singular response, so I changed the model’s name to <code class="docutils literal"><span class="pre">TriviaUserResponse</span></code>.  It complained at me when I tried to
do a <code class="docutils literal"><span class="pre">makemigrations</span></code> because <code class="docutils literal"><span class="pre">admin.py</span></code> couldn’t import TriviaUserResponses any more.  I changed the import and the
registration in <code class="docutils literal"><span class="pre">admin.py</span></code> and then both <code class="docutils literal"><span class="pre">makemigrations</span></code> and <code class="docutils literal"><span class="pre">migrate</span></code> worked properly.</p>
</div>
<div class="section" id="recording-results">
<h4>5.6.4.2. Recording Results<a class="headerlink" href="#recording-results" title="Permalink to this headline">¶</a></h4>
<p>It seemed more proper to make sure all the data gets saved to the database before displaying it so I decided to tend to
that before worrying about displaying it on the results page. First, saving the user’s answers to the current question:</p>
<table border="1" class="colwidths-auto docutils" id="id20">
<caption><span class="caption-text"><strong>Does the DisplayResult view record the user’s response?</strong></span><a class="headerlink" href="#id20" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Success?</th>
<th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>database is not changed at all</td>
<td>add lines to DisplayResult’s post method to update the database</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>complained that ‘User’ object has no attribute ‘get_name’</td>
<td>call for user.userprofle.get_name in models</td>
</tr>
<tr class="row-even"><td>No</td>
<td>TypeError in __str__ for TriviaUserResponse</td>
<td>call for str(self.response)</td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>Jim’s response to question 1: 32 displayed in <code class="docutils literal"><span class="pre">admin</span></code></td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="colwidths-auto docutils" id="id21">
<caption><span class="caption-text"><strong>Does the DisplayResult view record update the trivia information in UserProfile?</strong></span><a class="headerlink" href="#id21" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Success?</th>
<th class="head">Result</th>
<th class="head">Action to be Taken</th>
<th class="head">&#160;</th>
<th class="head">&#160;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>no changes are recorded there</td>
<td>add code to DisplayResult’s post method to handle this</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>No</td>
<td>no changes made</td>
<td>create a user profile in the view</td>
<td>modify it</td>
<td>then save it back to the database</td>
</tr>
<tr class="row-even"><td>Yes</td>
<td>changes are made in the user profile</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="colwidths-auto docutils" id="id22">
<caption><span class="caption-text"><strong>Does the button on the scoreboard page now say ‘Next Question’ instead of ‘First Question’?</strong></span><a class="headerlink" href="#id22" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Success?</th>
<th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Yes</td>
<td>&#160;</td>
<td>nothing I have to do</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="colwidths-auto docutils" id="id23">
<caption><span class="caption-text"><strong>Does the result page display the real correct answer?</strong></span><a class="headerlink" href="#id23" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Success?</th>
<th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>it displays the user’s choice as the correct answer</td>
<td>get correct answer in the view and send it to template</td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>it was quite easy to do</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="adding-a-next-question-button-to-the-results-page">
<h4>5.6.4.3. Adding a Next Question Button to the Results Page<a class="headerlink" href="#adding-a-next-question-button-to-the-results-page" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-auto docutils" id="id24">
<caption><span class="caption-text"><strong>Does a working ‘Next Question’ appear on the Results page?</strong></span><a class="headerlink" href="#id24" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Success?</th>
<th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>to get the next question I go back to the scoreboard page</td>
<td>add a next question button as in <code class="docutils literal"><span class="pre">scoreboard.html</span></code></td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>it worked right away</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Still needed:
* a means for preventing them from getting to questions beyond what they properly can
* a graceful means of handling question requests beyond the ones that exist
* better looking question and results pages</p>
</div>
</div>
<div class="section" id="result-page-response-correctness">
<h4>5.6.4.4. Result Page: Response Correctness<a class="headerlink" href="#result-page-response-correctness" title="Permalink to this headline">¶</a></h4>
<p>It seems this will require changes in the DisplayResult view since that seems like the best place to do the evaluation.</p>
<table border="1" class="colwidths-auto docutils" id="id25">
<caption><span class="caption-text"><strong>Does the Result page tell the user if their answer was right or wrong?</strong></span><a class="headerlink" href="#id25" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Success?</th>
<th class="head">Result</th>
<th class="head">Action to be Taken</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>No</td>
<td>only indicates their choice</td>
<td>change the view and trivia_result.html to display correctness</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/images/ThreeOrnaments.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="startup.html">1. Startup Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="c17conversion.html">2. Converting Christmas2016 to Christmas2017</a></li>
<li class="toctree-l1"><a class="reference internal" href="updating.html">3. Updating the Website</a></li>
<li class="toctree-l1"><a class="reference internal" href="new_apps.html">4. New Applications</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. The Trivia App</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#initial-thoughts">5.1. Initial Thoughts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-trivia-url-patterns">5.2. The Trivia URL Patterns</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#building-and-testing-the-url-patterns">5.2.1. Building and Testing the URL Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preventing-access-by-unauthenticated-users">5.2.2. Preventing access by Unauthenticated Users</a></li>
<li class="toctree-l3"><a class="reference internal" href="#displaying-the-header-on-each-trivia-page">5.2.3. Displaying the Header on Each Trivia Page</a></li>
<li class="toctree-l3"><a class="reference internal" href="#redirecting-badly-formed-trivia-urls-to-the-scoreboard-page">5.2.4. Redirecting Badly Formed trivia urls to the Scoreboard Page</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-trivia-menu-item-to-the-header">5.3. Adding a Trivia Menu Item to the Header</a></li>
<li class="toctree-l2"><a class="reference internal" href="#moving-to-kalamazoo-again">5.4. Moving to Kalamazoo Again</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-on-the-models">5.5. Working on the Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-trivia-models">5.5.1. Creating the Trivia Models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#building-the-trivia-app">5.6. Building the Trivia App</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#game-rules">5.6.1. Game Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-question-page">5.6.2. The Question Page</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-trivia-question-form-with-a-working-submit-button">5.6.3. Creating a Trivia Question Form with a working Submit Button</a></li>
<li class="toctree-l3"><a class="reference internal" href="#working-on-the-results-page">5.6.4. Working on the Results Page</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="notes.html">6. Notes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="new_apps.html" title="previous chapter">4. New Applications</a></li>
      <li>Next: <a href="notes.html" title="next chapter">6. Notes</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Jim Morris.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/trivia.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>